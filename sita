from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
import time


driver = webdriver.Chrome()
driver.get("https://icp.administracionelectronica.gob.es/icpplustieb/citar?p=8&locale=es")

search_box = driver.find_element(By.ID, "buscadorProvinciasInput")
search_box.send_keys("Barcelona")
search_button = driver.find_element(By.ID, "btnAceptar")
search_button.click()

try:
    available_slots = WebDriverWait(driver, 10).until(
        EC.presence_of_all_elements_located((By.CSS_SELECTOR, ".disp-fc-slot.libres a")))
    for slot in available_slots:
        if "Sita Asulim" in slot.text:
            slot.click()
            name_box = WebDriverWait(driver, 10).until(EC.presence_of_element_located((By.ID, "txtIdCitado")))
            name_box.send_keys("Kirill")
            surname_box = driver.find_element(By.ID, "txtApeCitado")
            surname_box.send_keys("Strelnikov")
            passport_box = driver.find_element(By.ID, "txtNumDocCitado")
            passport_box.send_keys("2204435971")
            city_box = driver.find_element(By.ID, "txtDesCitado")
            city_box.send_keys("Barcelona")
            request_button = driver.find_element(By.ID, "btnEnviar")
            request_button.click()
            print("Успешно записались на прием!")
            break
    else:
        print("Свободных слотов для записи не найдено!")
except:
    print("Не удалось найти свободные слоты!")

driver.quit()

